<div class="session-page-container content">
  <div class="session-header">
    @if (isEditingSession) {
      <h2>Modifica Sessione di Allenamento</h2>
    } @else {
      <h2>Crea Nuova Sessione di Allenamento</h2>
    }
  </div>

  <div class="session-form">
    <!-- Nome Sessione -->
    <div class="form-group">
      <label for="sessionName">Nome Sessione:</label>
      <input 
        id="sessionName" 
        type="text" 
        [(ngModel)]="sessionName" 
        placeholder="Es: Allenamento Gambe"
        class="input-field">
    </div>

    <!-- Seleziona Esercizi -->
    <div class="exercises-selector">
      <h3>Seleziona Esercizi</h3>
      <div class="available-exercises">
        @for (exercise of availableExercises(); track exercise.id) {
          <div class="exercise-item">
            <input 
              type="checkbox" 
              [id]="'ex-' + exercise.id"
              [checked]="isExerciseSelected(exercise.id)"
              (change)="toggleExercise(exercise)"
              class="checkbox">
            <label [for]="'ex-' + exercise.id" class="exercise-label">
              {{ exercise.name }} - {{ exercise.muscleGroup }}
            </label>
          </div>
        }
      </div>
    </div>

    <!-- Esercizi Selezionati -->
    @if (selectedExercises.length > 0) {
      <div class="selected-exercises">
        <h3>Esercizi Selezionati</h3>
        @for (item of selectedExercises; track item.exerciseId; let i = $index) {
          <div class="selected-exercise-card">
            <div class="exercise-info">
              <h4>{{ item.exerciseName }}</h4>
              <p class="muscle-group">{{ item.muscleGroup }}</p>
            </div>

            <div class="exercise-inputs">
              <div class="input-group">
                <label>Serie:</label>
                <input 
                  type="number" 
                  [(ngModel)]="item.sets" 
                  min="1" 
                  class="small-input">
              </div>

              <div class="input-group">
                <label>Ripetizioni:</label>
                <input 
                  type="number" 
                  [(ngModel)]="item.reps" 
                  min="1" 
                  class="small-input">
              </div>

              <div class="input-group">
                <label>Peso (kg):</label>
                <input 
                  type="number" 
                  [(ngModel)]="item.weight" 
                  step="0.5" 
                  class="small-input">
              </div>

              <div class="input-group">
                <label>Note:</label>
                <input 
                  type="text" 
                  [(ngModel)]="item.notes" 
                  class="small-input">
              </div>
            </div>

            <p-button icon="pi pi-times" label="Rimuovi" severity="danger" 
                      (click)="removeExercise(i)"></p-button>
          </div>
        }
      </div>
    }

    <!-- Pulsanti Azioni -->
    <div class="action-buttons">
      <p-button [label]="isEditingSession ? 'âœ… Aggiorna Sessione' : 'ðŸ’¾ Salva Sessione'" 
                severity="help" (click)="saveSession()" 
                [disabled]="selectedExercises.length === 0"></p-button>
      <p-button label="âœ• Annulla" severity="secondary" (click)="cancelSession()"></p-button>
    </div>
  </div>

  <!-- Lista Sessioni Salvate -->
  @if (savedSessions().length > 0) {
    <div class="saved-sessions">
      <div class="sessions-header" (click)="togglePreviousSessions()" style="cursor: pointer; display: flex; align-items: center; gap: 10px;">
        <h3>Sessioni Precedenti ({{ savedSessions().length }})</h3>
        <p-button [icon]="showPreviousSessions ? 'pi pi-chevron-up' : 'pi pi-chevron-down'" 
                  [text]="true" 
                  severity="secondary"
                  (click)="togglePreviousSessions(); $event.stopPropagation()"></p-button>
      </div>
      @if (showPreviousSessions) {
        @for (session of savedSessions(); track session.id) {
        <div class="session-card">
          <h4>{{ session.name }}</h4>
          <p class="session-date">{{ session.date | date: 'dd/MM/yyyy HH:mm' }}</p>
          <p class="exercise-count">{{ session.exercises.length }} esercizi</p>
          <p-button icon="pi pi-download" label="Carica" severity="help" 
                    (click)="loadSession(session)"></p-button>
          <p-button icon="pi pi-trash" label="Elimina" severity="danger" 
                    (click)="deleteSession(session.id)"></p-button>
        </div>
      }
      }
    </div>
  }
</div>
